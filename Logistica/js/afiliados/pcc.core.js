var $userLayer=$('.user-floating');var $carritoHeader=$('#carrito-header');var $pcComBasket=$('#pccom-basket');var cartTimeout;function updateUserLayer(onlyUpdate)
{if($userLayer.length){$.get(Routing.generate('pcc_web_user_ajax'),function(data){//@todo Ver la posibilidad de llamar a un JSON y cargar los datos a partir de ah√≠
if(onlyUpdate){var $virtualObj=$('<div></div>').html(data);var cartUnits=$virtualObj.find('#cart-units').text();var $productList=$virtualObj.find('#pccom-basket').children();$carritoHeader.find('#cart-units').text(cartUnits);$pcComBasket.html($productList);$pcComBasket.siblings('script').replaceWith($virtualObj.find('script'));closeCart();}else{$userLayer.html(data);}});}else{if($('.input-units').length){$('.input-units').trigger('change');}}}
function closeCart(){$carritoHeader=$('#carrito-header');$pcComBasket=$('#pccom-basket');function setTimer(delay){if(!delay){delay=2000;}
cartTimeout=setTimeout(function(){$carritoHeader.parent().removeClass('active');},delay);}
$pcComBasket.on('mouseenter',function(){clearTimeout(cartTimeout);}).on('mouseleave',function(){setTimer(500);});setTimer();}
(function($){var PccEvents=PccEvents||{};PccEvents.ListenerLoader=function(){this.idCont=0;this.listeners=[];};PccEvents.ListenerLoader.prototype.get=function($listener){if($listener.is('['+ PccEvents.options.attr_id_listener+']')){return this.listeners[$listener.attr(PccEvents.options.attr_id_listener)];}else{var listener=new PccEvents.Listener($listener);$listener.attr(PccEvents.options.attr_id_listener,this.idCont);this.listeners[this.idCont++]=listener;return listener;}};var ListenerLoader=new PccEvents.ListenerLoader();PccEvents.options={attr_trigger:'data-pcc-trigger',attr_event:'data-pcc-event',attr_group:'data-pcc-group',attr_listener:'data-pcc-listen',attr_class:'data-pcc-class',attr_active_init:'data-pcc-active',attr_id_listener:'data-pcc-id-listener',attr_after:'data-pcc-after'};PccEvents.Observer=function($observer){this.observer=$observer;this.name=this.observer.attr(PccEvents.options.attr_trigger);this.group=this.observer.attr(PccEvents.options.attr_group);this.loadListeners();this.loadGroups();this.loadEvent();};PccEvents.Observer.prototype.loadGroups=function(){this.groups=[];if(this.group){var self=this;$('*['+ PccEvents.options.attr_group+'='+ this.group+']['+ PccEvents.options.attr_listener+']['+ PccEvents.options.attr_listener+'!='+ this.name+']').each(function(){self.groups.push(ListenerLoader.get($(this)));});}};PccEvents.Observer.prototype.loadListeners=function(){this.listeners=[];var self=this;$('*['+ PccEvents.options.attr_listener+'='+ this.name+']['+ PccEvents.options.attr_class+']').each(function(){var $this=$(this);var listener=ListenerLoader.get($this);self.listeners.push(listener);jQuery.data($this,'listener',listener);});};PccEvents.Observer.prototype.loadEvent=function(){var self=this;switch(this.observer.attr(PccEvents.options.attr_event)){case'hover':this.observer.on('mouseenter',function(){self.notify();}).on('mouseleave',function(){self.notify();});break;case'checked':this.observer.on('change',function(){self.notify();});break;case'click':default:this.observer.on('click',function(){self.notify();});break;}};PccEvents.Observer.prototype.notify=function(){for(var i=0,n=this.groups.length;i<n;i++){this.groups[i].reset();}
for(var i=0,n=this.listeners.length;i<n;i++){this.listeners[i].notify();}};PccEvents.Listener=function($listener){this.listener=$listener;this.class_name=this.listener.attr(PccEvents.options.attr_class);this.group=this.listener.attr(PccEvents.options.attr_group);this.initial_active=this.listener.is('['+ PccEvents.options.attr_active_init+']')?this.listener.attr(PccEvents.options.attr_active_init)=='1':this.listener.hasClass(this.class_name);this.current_active=this.listener.hasClass(this.class_name);this.after=this.listener.attr(PccEvents.options.attr_after);};PccEvents.Listener.prototype.notify=function(){if(this.current_active){this.listener.removeClass(this.class_name);this.current_active=false;}else{this.listener.addClass(this.class_name);this.current_active=true;}
if(this.after){this.listener.trigger(this.after);}};PccEvents.Listener.prototype.reset=function(){if(this.initial_active){this.listener.addClass(this.class_name);this.current_active=true;}else{this.listener.removeClass(this.class_name);this.current_active=false;}};$(function(){var triggers=[];$('*['+ PccEvents.options.attr_trigger+']').each(function(){var trigger=new PccEvents.Observer($(this));triggers.push(trigger);});});var $carousel=$('.owl-carousel');$('#menu-principal').hover(function(){$carousel.clearQueue().addClass("off-focus-slider");},function(){$carousel.delay(400).queue(function(next){$(this).removeClass("off-focus-slider");});});$('body').on('click','.btn-add-cart',function(e){var button=$(this);var url=Routing.generate('pcc_cart_add_item_ajax',{idArticle:button.data('id')}),param={'units':1,'warranty':0};$carritoHeader=$('#carrito-header');$pcComBasket=$('#pccom-basket');button.attr('disabled',true);button.stateButton('loading');$carritoHeader.parent().addClass('active');clearTimeout(cartTimeout);var loadingSection=$('<div></div>').html($('#ajax-loadin-container').html());loadingSection.find('.overlay-spin').css({top:0,position:'static'}).find('.spinner').css({margin:'0 auto 10px','box-shadow':'none'});$pcComBasket.prepend($('<li></li>').append(loadingSection).append($('<hr/>')));$.post(url,param,function(data){button.stateButton('reset');updateUserLayer(true);}).always(function(){button.removeAttr('disabled')});window.dataLayer=window.dataLayer||[];dataLayer.push({'event':'addToCart','ecommerce':{'currencyCode':'EUR','add':{'products':[{'name':$(this).data('name'),'id':$(this).data('id'),'price':$(this).data('price'),'brand':$(this).data('brand'),'category':$(this).data('category'),'quantity':$(this).data('qty')}]}}});var url2=Routing.generate('pcc_web_comethunter'),params={'event':'addToCart','quantity':$(this).data('qty'),'id_item':$(this).data('id'),'price':$(this).data('price'),'brand':$(this).data('brand'),'category':$(this).data('category'),'name':$(this).data('name')};$.post(url2,params,function(data){});window._vteq=window._vteq||[];window._vteq.push({"addtocart":{"itemId":$(this).data('id')}});});$(window).resize(function(){if($(window).width()>991){$('.superfamilia--desplegada').removeClass('superfamilia--desplegada');}});$(document).ready(function(){updateUserLayer();});}(jQuery));